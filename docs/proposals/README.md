# statutes RAG システム改善提案概要

本ディレクトリには、statutes-ragシステムの今後の発展方向に関する提案ドキュメントが含まれています。

## 提案ドキュメント一覧

### 1. Agent Lightning統合提案

**ファイル**: `agent-lightning-integration-proposal.md`

**概要**: Microsoft Agent Lightningを統合し、強化学習と自動プロンプト最適化によってRAGパイプラインを改善する提案。

**主要な内容**:
- Traditional RAGの制限と課題
- Agent Lightningの機能と利点
- 現在のプロジェクトとの互換性評価
- 具体的な統合アプローチ
- 段階的な実装計画（4フェーズ）

**期待効果**:
- 4択問題での精度向上: 10-20%
- プロンプトの自動最適化
- 継続的な学習と改善

**実装期間**: 6-8週間

---

### 2. Agentic RAG導入提案

**ファイル**: `agentic-rag-proposal.md`

**概要**: Traditional RAGからAgentic RAGへ進化させ、自律的なAIエージェントによる動的な情報検索と推論を実現する提案。

**主要な内容**:
- マルチエージェントアーキテクチャ設計
  - Manager Agent（調整役）
  - Retrieval Agent（動的検索）
  - Reasoning Agent（法的推論）
  - Validation Agent（品質保証）
- 反復的推論プロセス
- 法律専門ツール群の統合
- 段階的移行計画

**期待効果**:
- 複雑な法律質問への対応能力向上: 30-40%
- ハルシネーション減少: 60-70%
- より詳細で構造化された回答

**実装期間**: 7-9週間

**技術スタック**:
- LangChain/LangGraph
- マルチエージェントフレームワーク
- 既存のOllama LLM

---

### 3. MCPサーバ統合提案

**ファイル**: `mcp-server-integration.md`

**概要**: Model Context Protocol（MCP）サーバを実装し、静的データセットから動的API連携へ移行する提案。

**主要な内容**:
- MCPとは何か
- 現在の静的データセットの課題
- e-Gov法令APIとの統合
- デジタル庁法令APIv2への対応
- MCPサーバとクライアントの実装設計
- RAGパイプラインへの統合

**実装する主要ツール**:
- `search_law`: 法令検索
- `get_law_content`: 法令全文取得
- `get_article`: 特定条文取得
- `search_related_laws`: 関連法令検索
- `get_amendments`: 改正履歴取得

**期待効果**:
- 常に最新の法令データへアクセス
- 手動更新作業の削減
- システムの柔軟性と拡張性向上
- データストレージコストの削減

**実装期間**: 6週間

**技術スタック**:
- Model Context Protocol
- e-Gov法令検索API
- Python MCP SDK

---

### 4. 評価フレームワーク強化提案

**ファイル**: `evaluation-framework-enhancement.md`

**概要**: 現在の4択問題評価を超えて、より包括的で法律ドメインに特化した評価フレームワークを構築する提案。

**主要な内容**:
- 3つの評価柱
  1. Retrieval Quality評価
     - Recall@K, Precision@K, NDCG, MRR
     - LLMベース関連性評価
  
  2. Generation Quality評価
     - Faithfulness（忠実性）
     - Answer Relevance（回答関連性）
     - Correctness（正確性）
  
  3. Domain-Specific評価
     - 法的引用の正確性
     - 法的推論の妥当性
     - 法令間の関連性理解度

- 統合評価パイプライン
- 継続的評価システム
- モニタリングダッシュボード

**期待効果**:
- 多角的な性能評価
- 法律ドメインに特化した品質保証
- 継続的な改善サイクルの確立
- 本番環境での性能モニタリング

**実装期間**: 7週間

**技術スタック**:
- RAGAS（RAG評価フレームワーク）
- Pandas, Plotly（可視化）
- LLMベース評価

---

## 優先順位と依存関係

### 推奨実装順序

```
フェーズ1（基盤強化）:
├── 評価フレームワーク強化
│   └── 現状の正確な把握と改善点の特定
│
└── Agent Lightning統合
    └── プロンプト最適化による基本性能向上

フェーズ2（機能拡張）:
├── MCPサーバ統合
│   └── 動的データ取得基盤の構築
│
└── Agentic RAG導入（段階1-2）
    └── 基本的なマルチエージェント機能

フェーズ3（高度化）:
└── Agentic RAG導入（段階3-4）
    └── 完全なマルチエージェントシステム
```

### 依存関係図

```
評価フレームワーク
    ↓（評価指標提供）
Agent Lightning ← → Agentic RAG
    ↓（最適化）        ↓（検索強化）
        MCPサーバ統合
            ↓（データ提供）
        全体システム
```

## 技術的考慮事項

### 共通の課題

1. **レイテンシ管理**
   - 複雑な処理による応答時間の増加
   - キャッシング戦略の重要性
   - 非同期処理の活用

2. **コスト最適化**
   - LLM呼び出し回数の削減
   - ローカルLLM（Ollama）の継続活用
   - API呼び出しの効率化

3. **保守性とテスト**
   - モジュール化された設計
   - 包括的なテストスイート
   - デバッグツールの整備

### リソース要件

**開発リソース**:
- バックエンド開発者: 1-2名
- 評価・テスト担当: 1名
- 合計開発期間: 4-6ヶ月（並行実装の場合）

**インフラリソース**:
- 開発環境: 既存の環境で対応可能
- MCPサーバ: 軽量（既存サーバに同居可能）
- 評価システム: ストレージ追加（数GB程度）

## 段階的導入戦略

### ステージ1: 基盤整備（2-3ヶ月）

**目標**: 評価と最適化の基盤構築

**実施項目**:
1. 評価フレームワーク強化
   - Retrieval/Generation/Domain評価の実装
   - ベースライン性能の測定

2. Agent Lightning統合
   - 基本的なトレース機能
   - プロンプト最適化の実装

**マイルストーン**:
- [ ] 包括的な評価指標の確立
- [ ] ベースライン性能の文書化
- [ ] 最初のプロンプト最適化サイクル完了

### ステージ2: 機能拡張（2-3ヶ月）

**目標**: 動的データ取得とエージェント化の開始

**実施項目**:
1. MCPサーバ統合
   - 基本的なe-Gov API連携
   - ハイブリッド検索の実装

2. Agentic RAG（段階1-2）
   - Retrieval AgentとValidation Agent
   - 基本的なマルチエージェント協調

**マイルストーン**:
- [ ] リアルタイム法令データ取得の実現
- [ ] 動的検索戦略の実装
- [ ] エージェントベース検証の稼働

### ステージ3: 高度化（2-3ヶ月）

**目標**: 完全なAgentic RAGシステムの実現

**実施項目**:
1. Agentic RAG（段階3-4）
   - Reasoning AgentとManager Agent
   - 反復的推論プロセス
   - 法律専門ツール統合

2. 全体最適化
   - パフォーマンスチューニング
   - 本番環境への展開準備

**マイルストーン**:
- [ ] 完全なマルチエージェントシステム稼働
- [ ] 複雑な法律質問への高精度回答
- [ ] 本番環境での安定稼働

## 成功指標

### 定量的指標

| 指標 | 現在 | 目標（ステージ1） | 目標（ステージ3） |
|------|------|------------------|------------------|
| 4択正答率 | TBD | +10-15% | +20-30% |
| Faithfulness | TBD | >0.85 | >0.90 |
| Citation Accuracy | TBD | >0.80 | >0.90 |
| Average Response Time | TBD | <3秒 | <5秒 |
| Hallucination Rate | TBD | -30% | -60% |

### 定性的指標

- 複雑な法律質問への対応能力
- 法的推論の明確さと妥当性
- ユーザー満足度
- システムの保守性と拡張性

## まとめ

本提案群は、statutes-ragシステムを以下の観点から大幅に強化します:

1. **精度向上**: Agent LightningとAgentic RAGによる高度な推論
2. **データ鮮度**: MCPサーバによる最新法令データへのアクセス
3. **品質保証**: 包括的な評価フレームワーク
4. **システム進化**: 段階的かつ安全な機能拡張

これらの提案を段階的に実装することで、リスクを最小限に抑えながら、世界水準の法令RAGシステムを構築できます。

## 参考資料

- Agent Lightning: https://github.com/microsoft/agent-lightning
- MCP: https://modelcontextprotocol.io/
- e-Gov法令API: https://elaws.e-gov.go.jp/apitop/
- RAGAS: https://github.com/explodinggradients/ragas
